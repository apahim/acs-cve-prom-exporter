package exporter

import (
	"github.com/apahim/acs-cve-prom-exporter/internal/collector"
	"github.com/prometheus/client_golang/prometheus"
	"github.com/prometheus/client_golang/prometheus/promhttp"
	"log"
	"net/http"
)

func Run() {
	reg := prometheus.NewRegistry()

	// Create and register custom collector
	myCollector := collector.NewMyCollector()
	reg.MustRegister(myCollector)

	// Expose metrics via HTTP
	http.Handle("/metrics", promhttp.HandlerFor(reg, promhttp.HandlerOpts{}))
	log.Println("Beginning to serve on port :8080")
	log.Fatal(http.ListenAndServe(":8080", nil))
}
